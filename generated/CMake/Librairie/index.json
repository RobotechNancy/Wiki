{
    "hidden": "false",
    "title": "Cr\u00e9er une librairie",
    "description": "Comment cr\u00e9er une librairie installable avec CMake",
    "order": "4",
    "uri": "CMake/Librairie",
    "page_content": "<p>Pour cr\u00e9er une librairie, on utilise <code>add_library</code> avec le nom de la librairie et les fichiers source:</p>\n<div class=\"codehilite\"><pre tabindex='0'><span></span><code><span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"s\">CMAKE_CXX_STANDARD</span><span class=\"w\"> </span><span class=\"s\">20</span><span class=\"p\">)</span>\n<span class=\"nb\">cmake_minimum_required</span><span class=\"p\">(</span><span class=\"s\">VERSION</span><span class=\"w\"> </span><span class=\"s\">3.16</span><span class=\"p\">)</span>\n<span class=\"nb\">project</span><span class=\"p\">(</span><span class=\"s\">LibName</span><span class=\"w\"> </span><span class=\"s\">VERSION</span><span class=\"w\"> </span><span class=\"s\">0.1</span><span class=\"w\"> </span><span class=\"s\">DESCRIPTION</span><span class=\"w\"> </span><span class=\"s2\">&quot;Description de la librairie&quot;</span><span class=\"p\">)</span>\n\n<span class=\"nb\">add_library</span><span class=\"p\">(</span><span class=\"o\">${</span><span class=\"nv\">PROJECT_NAME</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"s\">...</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>Ensuite, on peut configurer la librairie avec <code>set_target_properties</code>.\nLes hearders publiques sont ceux qui seront install\u00e9s avec la librairie:</p>\n<div class=\"codehilite\"><pre tabindex='0'><span></span><code><span class=\"c\"># Version de la librairie</span>\n<span class=\"nb\">set_target_properties</span><span class=\"p\">(</span><span class=\"o\">${</span><span class=\"nv\">PROJECT_NAME</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"s\">PROPERTIES</span><span class=\"w\"> </span><span class=\"s\">VERSION</span><span class=\"w\"> </span><span class=\"o\">${</span><span class=\"nv\">PROJECT_VERSION</span><span class=\"o\">}</span><span class=\"p\">)</span>\n<span class=\"c\"># Inclure tous les headers publics s\u00e9par\u00e9s par des &quot;;&quot;</span>\n<span class=\"nb\">set_target_properties</span><span class=\"p\">(</span><span class=\"o\">${</span><span class=\"nv\">PROJECT_NAME</span><span class=\"o\">}</span><span class=\"w\"> </span><span class=\"s\">PROPERTIES</span><span class=\"w\"> </span><span class=\"s\">PUBLIC_HEADER</span><span class=\"w\"> </span><span class=\"s2\">&quot;...&quot;</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>Pour pouvoir installer la librairie, on utilise <code>install</code>:</p>\n<div class=\"codehilite\"><pre tabindex='0'><span></span><code><span class=\"c\"># Configuration d&#39;o\u00f9 et quoi est install\u00e9</span>\n<span class=\"nb\">include</span><span class=\"p\">(</span><span class=\"s\">GNUInstallDirs</span><span class=\"p\">)</span>\n<span class=\"nb\">install</span><span class=\"p\">(</span><span class=\"s\">TARGETS</span><span class=\"w\"> </span><span class=\"o\">${</span><span class=\"nv\">PROJECT_NAME</span><span class=\"o\">}</span>\n<span class=\"w\">        </span><span class=\"s\">LIBRARY</span><span class=\"w\"> </span><span class=\"s\">DESTINATION</span><span class=\"w\"> </span><span class=\"o\">${</span><span class=\"nv\">CMAKE_INSTALL_LIBDIR</span><span class=\"o\">}</span><span class=\"s\">/robotech</span>\n<span class=\"w\">        </span><span class=\"s\">PUBLIC_HEADER</span><span class=\"w\"> </span><span class=\"s\">DESTINATION</span><span class=\"w\"> </span><span class=\"o\">${</span><span class=\"nv\">CMAKE_INSTALL_INCLUDEDIR</span><span class=\"o\">}</span><span class=\"s\">/robotech</span><span class=\"p\">)</span>\n\n<span class=\"c\"># Cr\u00e9ation automatique d&#39;un fichier &quot;LibNameConfig.cmake&quot; \u00e0 partir de &quot;Config.cmake.in&quot;</span>\n<span class=\"nb\">configure_file</span><span class=\"p\">(</span><span class=\"s\">Config.cmake.in</span><span class=\"w\"> </span><span class=\"o\">${</span><span class=\"nv\">PROJECT_NAME</span><span class=\"o\">}</span><span class=\"s\">Config.cmake</span><span class=\"w\"> </span><span class=\"s\">@ONLY</span><span class=\"p\">)</span>\n<span class=\"nb\">install</span><span class=\"p\">(</span><span class=\"s\">FILES</span><span class=\"w\"> </span><span class=\"o\">${</span><span class=\"nv\">CMAKE_BINARY_DIR</span><span class=\"o\">}</span><span class=\"s\">/</span><span class=\"o\">${</span><span class=\"nv\">PROJECT_NAME</span><span class=\"o\">}</span><span class=\"s\">Config.cmake</span><span class=\"w\"> </span><span class=\"s\">DESTINATION</span><span class=\"w\"> </span><span class=\"o\">${</span><span class=\"nv\">CMAKE_INSTALL_DATAROOTDIR</span><span class=\"o\">}</span><span class=\"s\">/</span><span class=\"o\">${</span><span class=\"nv\">PROJECT_NAME</span><span class=\"o\">}</span><span class=\"s\">/cmake</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>Pour que la librairie soit trouvable par <code>find_package</code>, il faut cr\u00e9er un fichier <code>Config.cmake.in</code>:</p>\n<div class=\"codehilite\"><pre tabindex='0'><span></span><code><span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"s\">@PROJECT_NAME@_FOUND</span><span class=\"w\"> </span><span class=\"s\">TRUE</span><span class=\"p\">)</span>\n<span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"s\">@PROJECT_NAME@_VERSION</span><span class=\"w\"> </span><span class=\"s\">@PROJECT_VERSION@</span><span class=\"p\">)</span>\n\n<span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"s\">@PROJECT_NAME@_INCLUDE_DIRS</span><span class=\"w\"> </span><span class=\"s2\">&quot;@CMAKE_INSTALL_PREFIX@/@CMAKE_INSTALL_INCLUDEDIR@/robotech&quot;</span><span class=\"p\">)</span>\n<span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"s\">@PROJECT_NAME@_LIBRARIES</span><span class=\"w\"> </span><span class=\"s2\">&quot;@CMAKE_INSTALL_PREFIX@/@CMAKE_INSTALL_LIBDIR@/lib@PROJECT_NAME@.a&quot;</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>La librairie est maintenant installable avec <code>make install</code> et trouvable avec <code>find_package</code>.</p>"
}