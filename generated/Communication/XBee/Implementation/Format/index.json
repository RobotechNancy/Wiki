{
    "hidden": "false",
    "title": "Format des trames",
    "description": "Documentation sur le format des trames et leur validation",
    "order": "1",
    "uri": "Communication/XBee/Implementation/Format",
    "page_content": "<p>Toutes les trames suivent un format bien sp\u00e9cifique :</p>\n<table tabindex='0'>\n<thead>\n<tr>\n<th>Champ</th>\n<th style=\"text-align: center;\">Taille (octets)</th>\n<th style=\"text-align: center;\">Longueur totale (octets)</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>SOH</td>\n<td style=\"text-align: center;\">1</td>\n<td style=\"text-align: center;\">1</td>\n<td>D\u00e9but de la trame (0x01)</td>\n</tr>\n<tr>\n<td>LEN</td>\n<td style=\"text-align: center;\">1</td>\n<td style=\"text-align: center;\">2</td>\n<td>Longueur de la trame</td>\n</tr>\n<tr>\n<td>~LEN</td>\n<td style=\"text-align: center;\">1</td>\n<td style=\"text-align: center;\">3</td>\n<td>N\u00e9gation de LEN</td>\n</tr>\n<tr>\n<td>ADDR_RECV</td>\n<td style=\"text-align: center;\">1</td>\n<td style=\"text-align: center;\">4</td>\n<td>Adresse du module receveur</td>\n</tr>\n<tr>\n<td>ADDR_EMIT</td>\n<td style=\"text-align: center;\">1</td>\n<td style=\"text-align: center;\">5</td>\n<td>Adresse du module emetteur</td>\n</tr>\n<tr>\n<td>FCT_CODE</td>\n<td style=\"text-align: center;\">1</td>\n<td style=\"text-align: center;\">6</td>\n<td>Code fonction</td>\n</tr>\n<tr>\n<td>ID</td>\n<td style=\"text-align: center;\">1</td>\n<td style=\"text-align: center;\">7</td>\n<td>Identifiant de la trame</td>\n</tr>\n<tr>\n<td>CRC_HEADER</td>\n<td style=\"text-align: center;\">2</td>\n<td style=\"text-align: center;\">9</td>\n<td>Checksum des octets 0 \u00e0 6</td>\n</tr>\n<tr>\n<td>DATA</td>\n<td style=\"text-align: center;\">n</td>\n<td style=\"text-align: center;\">9+n</td>\n<td>Donn\u00e9es</td>\n</tr>\n<tr>\n<td>CRC_DATA</td>\n<td style=\"text-align: center;\">2</td>\n<td style=\"text-align: center;\">11+n</td>\n<td>Checksum des octets 9 \u00e0 n+8</td>\n</tr>\n</tbody>\n</table>\n<p>Plusieurs validation sont effectu\u00e9es lors de la r\u00e9ception de donn\u00e9es :</p>\n<ul>\n<li>Longueur de la trame (trop petite ou grande)</li>\n<li>Les premier et dernier octets doivent correspondre \u00e0 <code>XB_FRAME_SOH</code> et <code>XB_FRAME_EOT</code> respectivement</li>\n<li>Le deuxi\u00e8me octet (longueur de la trame) doit \u00eatre \u00e9gual \u00e0 la n\u00e9gation du troisi\u00e8me octet</li>\n<li>Le deuxi\u00e8me octet (longueur de l'octet) doit \u00eatre \u00e9gual \u00e0 la longueur de la trame re\u00e7ue</li>\n<li>Validation des checksum (XOR de chaque octet avec <code>0x0000</code> initialement)</li>\n</ul>\n<p>Les checksum sont calcul\u00e9s de la m\u00eame mani\u00e8re :</p>\n<div class=\"codehilite\"><pre tabindex='0'><span></span><code><span class=\"kt\">uint16_t</span><span class=\"w\"> </span><span class=\"nf\">XBee::computeChecksum</span><span class=\"p\">(</span><span class=\"k\">const</span><span class=\"w\"> </span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">vector</span><span class=\"o\">&lt;</span><span class=\"kt\">uint8_t</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"n\">frame</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">checksum</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mh\">0x0000</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// On applique un XOR pour chaque octet</span>\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">start</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span>\n<span class=\"w\">        </span><span class=\"n\">checksum</span><span class=\"w\"> </span><span class=\"o\">^=</span><span class=\"w\"> </span><span class=\"n\">frame</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">];</span>\n\n<span class=\"w\">    </span><span class=\"c1\">// On ne peut transmettre que des octets donc on s\u00e9pare le checksum en deux</span>\n<span class=\"w\">    </span><span class=\"c1\">// 0x50 permet de faciliter l&#39;\u00e9chantillonnage du signal</span>\n<span class=\"w\">    </span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">checksumLSB</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">checksum</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"mh\">0x0F</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mh\">0x50</span><span class=\"p\">;</span>\n<span class=\"w\">    </span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">checksumMSB</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">checksum</span><span class=\"w\"> </span><span class=\"o\">&amp;</span><span class=\"w\"> </span><span class=\"mh\">0xF0</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&gt;&gt;</span><span class=\"w\"> </span><span class=\"mi\">4</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"mh\">0x50</span><span class=\"p\">;</span>\n\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">checksumMSB</span><span class=\"w\"> </span><span class=\"o\">&lt;&lt;</span><span class=\"w\"> </span><span class=\"mi\">8</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">checksumLSB</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div>"
}