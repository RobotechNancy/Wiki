<!DOCTYPE html>

<html lang="fr">
	<head>
		<meta charset="utf-8">
		<title>Wiki Robotech Nancy - Utiliser la librairie</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="Comment utiliser la librairie custom pour générer jusqu'à 16 signaux PWM">

		<link rel="stylesheet" href="http://127.0.0.1:8000/static/style.css">
		<link rel="apple-touch-icon" href="http://127.0.0.1:8000/static/images/icons/logo.webp">
		<link rel="icon" type="image/webp" href="http://127.0.0.1:8000/static/images/icons/logo.webp">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700&display=swap">
	</head>

	<body>
		<header>
			<h1>
				<a href="http://127.0.0.1:8000/">
					<img src="http://127.0.0.1:8000/static/images/icons/logo.webp" width="40" height="40" alt="Logo Robotech Nancy">
					<span>Wiki Robotech Nancy</span>
				</a>
				<button type="button" class="open-nav" aria-label="Ouvrir la navigation" onclick="document.body.classList.toggle('nav-open')"></button>
			</h1>

			<nav>
				<div>
					
    

    <a href="http://127.0.0.1:8000/Cartes/">Cartes utilisées</a>
    

    <a href="http://127.0.0.1:8000/Wiki/">Modifier ce wiki</a>
    

    <details>
        <summary>Build avec CMake</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/CMake/Installation/">Installer CMake</a>
    

    <a href="http://127.0.0.1:8000/CMake/Executable/">Créer un exécutable</a>
    

    <a href="http://127.0.0.1:8000/CMake/Lier/">Lier des librairies</a>
    

    <a href="http://127.0.0.1:8000/CMake/Librairie/">Créer une librairie</a>
    

        </div>
    </details>
    

    <details>
        <summary>Projets STM32</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/STM32/Installation/">Installation</a>
    

    <a href="http://127.0.0.1:8000/STM32/Projet/">Créer un projet</a>
    

    <a href="http://127.0.0.1:8000/STM32/CubeMX/">Configurer une carte</a>
    

        </div>
    </details>
    

    <details>
        <summary>Bus CAN</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/CAN/Principe/">Principe</a>
    

    <a href="http://127.0.0.1:8000/CAN/Raspberry/">Librairie Raspberry</a>
    

    <a href="http://127.0.0.1:8000/CAN/STM32/">Librairie STM32</a>
    

    <details>
        <summary>Implémentation</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/CAN/Implementation/Format/">Format des trames</a>
    

    <a href="http://127.0.0.1:8000/CAN/Implementation/Librairie/">Initialisation</a>
    

    <a href="http://127.0.0.1:8000/CAN/Implementation/Reception/">Réception de données</a>
    

    <a href="http://127.0.0.1:8000/CAN/Implementation/Envoi/">Envoi de données</a>
    

        </div>
    </details>
    

        </div>
    </details>
    

    <details>
        <summary>Modules XBee</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/XBee/Principe/">Principe</a>
    

    <a href="http://127.0.0.1:8000/XBee/Librairie/">Utiliser la librairie</a>
    

    <details>
        <summary>Implémentation</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/XBee/Implementation/Format/">Format des trames</a>
    

    <a href="http://127.0.0.1:8000/XBee/Implementation/Initialisation/">Initialisation</a>
    

    <a href="http://127.0.0.1:8000/XBee/Implementation/Reception/">Réception de données</a>
    

    <a href="http://127.0.0.1:8000/XBee/Implementation/Envoi/">Envoi de données</a>
    

        </div>
    </details>
    

        </div>
    </details>
    

    <details>
        <summary>Odométrie</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/Odometrie/ArUCO/">Marqueurs ArUCO</a>
    

    <a href="http://127.0.0.1:8000/Odometrie/Optique/">Capteur optique</a>
    

        </div>
    </details>
    

    <details>
        <summary>Signaux PWM</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/PWM/STM32/">STM32</a>
    

    <details>
        <summary>PCA9685</summary>
        <div>
            
    <a href="http://127.0.0.1:8000/PWM/PCA9685/Librairie/">Utiliser la librairie</a>
    

    <a href="http://127.0.0.1:8000/PWM/PCA9685/Implementation/">Implémentation</a>
    

        </div>
    </details>
    

        </div>
    </details>
    

				</div>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>PWM/PCA9685/Librairie</h2>
				<h3 class="no-anchor">Utiliser la librairie</h3>
			</div>
			<article class="content">
				<p>La carte PCA9685 permet de contrôler jusqu'à 16 sorties <a href="http://127.0.0.1:8000/PWM/STM32">PWM</a> par I2C :
<img alt="PCA965" loading="lazy" src="http://127.0.0.1:8000/static/images/PWM/PCA9685.webp" /></p>
<h3>Initialisation</h3>
<p>L'initialisation de la carte se fait automatiquement avec <code>PCA9685_init()</code>. Quelques détails importants sur la carte :</p>
<ul>
<li>Clock interne de 25MHz</li>
<li>Compteur 12 bits (0 à 4095)</li>
<li>Fréquence du bus I2C : 100kHz</li>
<li>Résistances de pull-up externes : 1 kΩ</li>
<li>Output Enable (OE) à 0 pour activer les sorties</li>
</ul>
<h3>Contrôle des sorties</h3>
<p>Pour contrôler une sortie, il faut d'abord modifier certaines valeurs dans <code>PCA9685.h</code> :</p>
<table tabindex='0'>
<thead>
<tr>
<th style="text-align: left;">Servo-moteur</th>
<th style="text-align: center;">PCA_PRESCALER_FREQ (Hz)</th>
<th style="text-align: center;">PCA_PWM_MIN_TIME (ms)</th>
<th style="text-align: center;">PCA_PWM_MAX_TIME (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Analogique</td>
<td style="text-align: center;">50Hz</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">2.0</td>
</tr>
<tr>
<td style="text-align: left;">Numérique</td>
<td style="text-align: center;">125Hz</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">2.5</td>
</tr>
<tr>
<td style="text-align: left;">Numérique</td>
<td style="text-align: center;">250Hz</td>
<td style="text-align: center;">0.266</td>
<td style="text-align: center;">0.533</td>
</tr>
</tbody>
</table>
<p>Les comptes sont alors automatiquement calculés et stockés dans <code>PCA9685.h</code> :</p>
<table tabindex='0'>
<thead>
<tr>
<th style="text-align: left;">Servo-moteur</th>
<th style="text-align: center;">PCA_PWM_RANGE</th>
<th style="text-align: center;">PCA_PWM_MIN</th>
<th style="text-align: center;">PCA_PWM_MAX</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Analogique</td>
<td style="text-align: center;">204</td>
<td style="text-align: center;">205</td>
<td style="text-align: center;">409</td>
</tr>
<tr>
<td style="text-align: left;">Numérique (125Hz)</td>
<td style="text-align: center;">1024</td>
<td style="text-align: center;">256</td>
<td style="text-align: center;">1280</td>
</tr>
<tr>
<td style="text-align: left;">Numérique (250Hz)</td>
<td style="text-align: center;">273</td>
<td style="text-align: center;">272</td>
<td style="text-align: center;">545</td>
</tr>
</tbody>
</table>
<p>Après avoir initialisé la carte avec <code>PCA9685_init()</code>, on peut contrôler les sorties :</p>
<div class="codehilite"><pre tabindex='0'><span></span><code><span class="c1">// Directement définir la valeur du PWM (0 à PCA_PWM_RANGE)</span>
<span class="kt">int</span><span class="w"> </span><span class="n">PCA9685_set_pwm</span><span class="p">(</span><span class="n">I2C_HandleTypeDef</span><span class="w"> </span><span class="o">*</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">points</span><span class="p">)</span>

<span class="c1">// Définir un cycle (entre 0 et 1)</span>
<span class="kt">int</span><span class="w"> </span><span class="n">PCA9685_set_cycle</span><span class="p">(</span><span class="n">I2C_HandleTypeDef</span><span class="w"> </span><span class="o">*</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">duty_cycle</span><span class="p">)</span>

<span class="c1">// Désactiver un channel (0 à 15)</span>
<span class="kt">int</span><span class="w"> </span><span class="n">PCA9685_turn_off</span><span class="p">(</span><span class="n">I2C_HandleTypeDef</span><span class="w"> </span><span class="o">*</span><span class="n">i2c</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">channel</span><span class="p">)</span>
</code></pre></div>
			</article>
		</section>

		<script src="http://127.0.0.1:8000/static/script.js"></script>
	</body>
</html>