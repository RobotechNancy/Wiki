{
    "hidden": "false",
    "title": "Utiliser la librairie",
    "description": "Comment utiliser la librairie custom pour g\u00e9n\u00e9rer jusqu'\u00e0 16 signaux PWM",
    "order": "1",
    "uri": "PWM/PCA9685/Librairie",
    "page_content": "<p>La carte PCA9685 permet de contr\u00f4ler jusqu'\u00e0 16 sorties <a href=\"http://127.0.0.1:8000/PWM/STM32\">PWM</a> par I2C :\n<img alt=\"PCA965\" loading=\"lazy\" src=\"http://127.0.0.1:8000/static/images/PWM/PCA9685.webp\" /></p>\n<h3>Initialisation</h3>\n<p>L'initialisation de la carte se fait automatiquement avec <code>PCA9685_init()</code>. Quelques d\u00e9tails importants sur la carte :</p>\n<ul>\n<li>Clock interne de 25MHz</li>\n<li>Compteur 12 bits (0 \u00e0 4095)</li>\n<li>Fr\u00e9quence du bus I2C : 100kHz</li>\n<li>R\u00e9sistances de pull-up externes : 1 k\u03a9</li>\n<li>Output Enable (OE) \u00e0 0 pour activer les sorties</li>\n</ul>\n<h3>Contr\u00f4le des sorties</h3>\n<p>Pour contr\u00f4ler une sortie, il faut d'abord modifier certaines valeurs dans <code>PCA9685.h</code> :</p>\n<table tabindex='0'>\n<thead>\n<tr>\n<th style=\"text-align: left;\">Servo-moteur</th>\n<th style=\"text-align: center;\">PCA_PRESCALER_FREQ (Hz)</th>\n<th style=\"text-align: center;\">PCA_PWM_MIN_TIME (ms)</th>\n<th style=\"text-align: center;\">PCA_PWM_MAX_TIME (ms)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\">Analogique</td>\n<td style=\"text-align: center;\">50Hz</td>\n<td style=\"text-align: center;\">1.0</td>\n<td style=\"text-align: center;\">2.0</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">Num\u00e9rique</td>\n<td style=\"text-align: center;\">125Hz</td>\n<td style=\"text-align: center;\">0.5</td>\n<td style=\"text-align: center;\">2.5</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">Num\u00e9rique</td>\n<td style=\"text-align: center;\">250Hz</td>\n<td style=\"text-align: center;\">0.266</td>\n<td style=\"text-align: center;\">0.533</td>\n</tr>\n</tbody>\n</table>\n<p>Les comptes sont alors automatiquement calcul\u00e9s et stock\u00e9s dans <code>PCA9685.h</code> :</p>\n<table tabindex='0'>\n<thead>\n<tr>\n<th style=\"text-align: left;\">Servo-moteur</th>\n<th style=\"text-align: center;\">PCA_PWM_RANGE</th>\n<th style=\"text-align: center;\">PCA_PWM_MIN</th>\n<th style=\"text-align: center;\">PCA_PWM_MAX</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: left;\">Analogique</td>\n<td style=\"text-align: center;\">204</td>\n<td style=\"text-align: center;\">205</td>\n<td style=\"text-align: center;\">409</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">Num\u00e9rique (125Hz)</td>\n<td style=\"text-align: center;\">1024</td>\n<td style=\"text-align: center;\">256</td>\n<td style=\"text-align: center;\">1280</td>\n</tr>\n<tr>\n<td style=\"text-align: left;\">Num\u00e9rique (250Hz)</td>\n<td style=\"text-align: center;\">273</td>\n<td style=\"text-align: center;\">272</td>\n<td style=\"text-align: center;\">545</td>\n</tr>\n</tbody>\n</table>\n<p>Apr\u00e8s avoir initialis\u00e9 la carte avec <code>PCA9685_init()</code>, on peut contr\u00f4ler les sorties :</p>\n<div class=\"codehilite\"><pre tabindex='0'><span></span><code><span class=\"c1\">// Directement d\u00e9finir la valeur du PWM (0 \u00e0 PCA_PWM_RANGE)</span>\n<span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">PCA9685_set_pwm</span><span class=\"p\">(</span><span class=\"n\">I2C_HandleTypeDef</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">i2c</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">channel</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">uint16_t</span><span class=\"w\"> </span><span class=\"n\">points</span><span class=\"p\">)</span>\n\n<span class=\"c1\">// D\u00e9finir un cycle (entre 0 et 1)</span>\n<span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">PCA9685_set_cycle</span><span class=\"p\">(</span><span class=\"n\">I2C_HandleTypeDef</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">i2c</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">channel</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">float</span><span class=\"w\"> </span><span class=\"n\">duty_cycle</span><span class=\"p\">)</span>\n\n<span class=\"c1\">// D\u00e9sactiver un channel (0 \u00e0 15)</span>\n<span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">PCA9685_turn_off</span><span class=\"p\">(</span><span class=\"n\">I2C_HandleTypeDef</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"n\">i2c</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">uint8_t</span><span class=\"w\"> </span><span class=\"n\">channel</span><span class=\"p\">)</span>\n</code></pre></div>"
}